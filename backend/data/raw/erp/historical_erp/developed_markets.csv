import pandas as pd
from datetime import date
import os

def build_developed_markets_dataset(as_of: str | None = None):
    if as_of is None:
        as_of = str(date.today())

    rows = [
        ("United States",as_of,0.052,0.000,0.037,0.88,1.00,0.35,0.23,4000,18,3.5,10.0,0.015,"Baseline DM anchor"),
        ("Germany",as_of,0.050,0.000,0.025,0.85,1.05,0.40,0.24,800,14,1.5,8.0,0.030,"Eurozone core"),
        ("France",as_of,0.051,0.000,0.025,0.86,1.06,0.42,0.24,700,15,1.6,8.2,0.028,"CAC40 heavy multinationals"),
        ("UK",as_of,0.053,0.002,0.030,0.88,1.08,0.45,0.23,900,13,1.4,7.5,0.035,"Brexit-adjusted ERP"),
        ("Japan",as_of,0.048,0.000,0.010,0.85,0.95,0.25,0.23,3500,16,1.3,8.0,0.025,"Deflation-adjusted ERP"),
        ("Canada",as_of,0.052,0.000,0.028,0.87,1.02,0.38,0.24,700,15,1.6,8.5,0.028,"Commodity-linked, DM status"),
        ("Australia",as_of,0.051,0.000,0.029,0.88,1.03,0.39,0.25,500,16,1.7,8.8,0.030,"Mining heavy, stable DM"),
        ("Developed Avg",as_of,0.051,0.000,0.027,0.87,1.02,0.38,0.24,11100,15,2.4,8.7,0.028,"Weighted average across DMs"),
    ]

    df = pd.DataFrame(rows, columns=[
        "country","as_of","erp_implied","crp","rf_rate",
        "unlevered_beta","levered_beta","avg_debt_to_equity","tax_rate",
        "n_firms","pe","pb","ev_ebitda","dividend_yield","notes"
    ])
    return df

if __name__ == "__main__":
    df = build_developed_markets_dataset()
    out_path = "data/adamodar/curated/regions/developed_markets.csv"
    os.makedirs(os.path.dirname(out_path), exist_ok=True)
    df.to_csv(out_path, index=False)
    print(f"âœ… Developed markets dataset written to {out_path}")