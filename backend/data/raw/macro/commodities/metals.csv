import pandas as pd
from datetime import date
import os

def build_metals(as_of: str | None = None) -> pd.DataFrame:
    if as_of is None:
        as_of = str(date.today())
    
    rows = [
        ("United States",as_of,6.0e11,8.0e10,5.0e10,1.2e11,4.0e10,1.4,0.10,0.08,7.5,0.022,"Steel, aluminum, diversified miners"),
        ("Developed ex-US",as_of,5.0e11,7.0e10,4.0e10,1.0e11,3.5e10,1.3,0.09,0.08,7.0,0.025,"EU, Australia, Canada producers"),
        ("Emerging Mkts",as_of,8.0e11,9.5e10,6.0e10,1.5e11,5.5e10,1.7,0.11,0.075,6.2,0.030,"Brazil, India, China miners"),
        ("Frontier Mkts",as_of,2.0e11,1.5e10,0.9e10,2.5e10,1.0e10,2.2,0.08,0.045,5.5,0.035,"Africa-focused mining firms"),
        ("Global Avg",as_of,2.1e12,2.6e11,1.9e11,4.2e11,1.4e11,1.5,0.10,0.072,6.8,0.028,"Weighted across metals sector"),
    ]
    
    df = pd.DataFrame(rows, columns=[
        "region","as_of","revenue","operating_income","net_income","ebitda","capex",
        "debt_to_equity","roe","net_margin","ev_ebitda","dividend_yield","notes"
    ])
    return df

if __name__ == "__main__":
    df = build_metals()
    out_path = "data/adamodar/curated/sectors/metals.csv"
    os.makedirs(os.path.dirname(out_path), exist_ok=True)
    df.to_csv(out_path, index=False)
    print(f"âœ… Metals dataset written to {out_path}")