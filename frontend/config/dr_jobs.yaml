# dr_jobs.yaml
# Kubernetes CronJobs for scheduled analyst tasks
# These jobs publish signals into Redis (or call APIs) to trigger analytics.

apiVersion: batch/v1
kind: CronJob
metadata:
  name: nightly-gnn-refresh
spec:
  schedule: "15 20 * * 1-5"   # 20:15 IST on weekdays
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          containers:
            - name: nightly-gnn-refresh
              image: myregistry/analyst-tools:latest   # <-- replace with your image
              imagePullPolicy: IfNotPresent
              command:
                - "python"
                - "-m"
                - "tools.publish_signal"
              args:
                - "--stream=prices"
                - "--topic=snapshot"
                - "--payload={\"reason\":\"nightly_refresh\"}"
              env:
                - name: REDIS_HOST
                  value: "redis"
                - name: REDIS_PORT
                  value: "6379"

---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: hourly-var-check
spec:
  schedule: "5 * * * *"   # 5 minutes past every hour
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          containers:
            - name: hourly-var-check
              image: myregistry/analyst-tools:latest   # <-- replace with your image
              imagePullPolicy: IfNotPresent
              command:
                - "python"
                - "-m"
                - "tools.publish_signal"
              args:
                - "--stream=signals"
                - "--topic=risk_request"
                - "--payload={\"reason\":\"hourly_var\"}"
              env:
                - name: REDIS_HOST
                  value: "redis"
                - name: REDIS_PORT
                  value: "6379"
